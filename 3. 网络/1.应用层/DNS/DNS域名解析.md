DNS是基于UDP做的查询。

✍🏻：以浏览器为例，从用户发出指令到页面显示的这部分响应时间为：

响应时间 = DNS解析时间 + TCP连接建立时间 + HTTP交易时间

为了让响应时间尽可能的小，只有让DNS解析时间尽可能小了

# DNS 域名解析过程
## 1） 浏览器缓存
浏览器会在**浏览器自身的DNS缓存**中找（缓存时间比较短，大概只有1分钟，且只能容纳1000条缓存）是否有该域名对应的IP地址。若曾访问过该域名且没有过期则存在。
 
> 查看Chrome自身的缓存:使用 chrome://net-internals/#dns 
## 2）操作系统缓存
如果浏览器自身的缓存里面没有找到对应的IP，那会检查**操作系统**自身的DNS缓存,如果找到且没有过期则停止搜索解析到此结束.
 
> 查看操作系统自身的DNS缓存 : Windows系统中，在命令行下使用 ipconfig /displaydns 来进行查看 

## 3） Host文件缓存
如果在操作系统的DNS缓存也没有找到，那么检查**系统hosts文件**看是否有该域名对应的IP地址。（位于C:\Windows\System32\drivers\etc）

## 4） 路由器缓存
检查路由器缓存中是否存在对应的IP地址。

## 5）ISP(互联网服务提供商) DNS缓存
浏览器发起一个DNS的系统调用，就会向本地配置的首选DNS服务器，发起域名解析请求（通过的是UDP协议向DNS的53端口发起请求，这个请求是**递归**的请求，也就是运营商的DNS服务器必须得提供给我们该域名的IP地址）如果你用的是电信的网络，则会进入电信的DNS缓存服务器中进行查找

## 6）根域名服务器
全球仅有13台根域名服务器，1个主根域名服务器，其余12为辅根域名服务器。根域名收到请求后会查看区域文件记录，若无则将其管辖范围内顶级域名(如.com)服务器IP告诉本地DNS服务器。

## 7）顶级域名服务器
顶级域名服务器收到请求后查看区域文件记录，若无则将其管辖范围内主域名服务器的IP地址告诉本地DNS服务器。

## 8）主域名服务器
主域名服务器接收到请求后查询自己的缓存，如果没有则进入下一级域名服务器进行查找，并重复该步骤直到找到正确记录。(迭代请求)

## 9）保存结果至缓存
本地域名服务器把返回的结果保存到缓存，以备下一次使用，同时将该结果反馈给客户端。客户端通过这个IP地址与web服务器建立连接。

注：一般情况下是不会进行以下步骤的

如果经过以上的步骤，还没有解析成功，那么会进行如下步骤：
1. 操作系统就会查找NetBIOS name Cache（NetBIOS名称缓存，就存在客户端电脑中的），那这个缓存有什么东西呢？凡是最近一段时间内和我成功通讯的计算机的计算机名和Ip地址，就都会存在这个缓存里面。什么情况下该步能解析成功呢？就是该名称正好是几分钟前和我成功通信过，那么这一步就可以成功解析。

2. 如果第5步也没有成功，那会查询WINS 服务器（是NETBIOS名称和IP地址对应的服务器）

3. 如果第6步也没有查询成功，那么客户端就要进行广播查找

4. 如果第7步也没有成功，那么客户端就读取LMHOSTS文件（和HOSTS文件同一个目录下，写法也一样）


## 迭代查询和递归查询
一、主机向本地域名服务器的查询一般都是采用递归查询。所谓递归查询就是：如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，那么本地域名服务器就以DNS客户的身份，向其它根域名服务器继续发出查询请求报文(即替主机继续查询)，而不是让主机自己进行下一步查询。因此，递归查询返回的查询结果或者是所要查询的IP地址，或者是报错，表示无法查询到所需的IP地址。

二、本地域名服务器向根域名服务器的查询的迭代查询。迭代查询的特点：当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地服务器：“你下一步应当向哪一个域名服务器进行查询”。然后让本地服务器进行后续的查询。根域名服务器通常是把自己知道的顶级域名服务器的IP地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器查询。顶级域名服务器在收到本地域名服务器的查询请求后，要么给出所要查询的IP地址，要么告诉本地服务器下一步应当向哪一个权限域名服务器进行查询。最后，知道了所要解析的IP地址或报错，然后把这个结果返回给发起查询的主机。
