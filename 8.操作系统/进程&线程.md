# 进程 和 线程
进程和线程都是 CPU 工作时间片的一个描述。

- 进程是**CPU在运行指令和加载保存上下文所需要的时间**；线程是进程中的更小单位，指的是**执行一段指令所需要的时间**。
- 进程是资源分配的基本单位，线程是调度的基本单位。

- 同一进程内不同的线程共享空间

🌰：打开一个 tab 页，其实就是创建了一个进程，一个进程中可以有多个线程，比如渲染线程、JS引擎线程、HTTP请求线程等。当发起了一个请求，其实就是创建了一个线程，当请求结束后，该线程可能会被销毁。

# JS 是单线程执行的

单线程，也就是说同一时间只能做一件事，JS 的单线程和它的用途有关。作为**浏览器脚本语言**，JS 的主要用途是**与用户交互**以及**操作 DOM**。

这决定了它只能是单线程，否则会带来很复杂的同步问题：假设 JS 同时有两个线程，一个线程在某个 DOM 节点上添加内容，另一个线程删除了这个节点，那么浏览器该咋做呢。

# 单线程好处
*在 JS 运行的时候可能会阻止 UI 渲染，这说明两个线程是互斥的。*

**原因**：JS 可以修改 DOM，如果在 JS 执行的时候 UI 线程还在工作，就可能导致不能安全的渲染 UI 。

这其实也是单线程的一个好处，JS 是单线程运行的，可以达到**节省内存，节约上下文切换时间，没有锁的问题**的好处。

锁的问题：当我读取一个数字时，同时有两个操作堆数字进行加减，这时结果就出现了错误。只需要在读取的时候加锁，直到读取完毕都不能进行写入操作就可以解决了。

# JS 单线程，怎么执行异步代码？

JS 引擎执行异步代码而不用等待，是因为有**消息队列**和**事件循环**。

- 消息队列：是一个先进先出的队列，里面存放着各种消息。
  - 消息队列中存放的消息，我们可以认为是**注册异步任务时添加的回调函数**。

- 事件循环：指主线程重复从消息队列中取消息，执行的过程

*事件循环机制详解*：

实际上，主线程只会做一件事情，就是从消息队列中取消息、执行消息，再取消息，再执行。当消息队列为空时，就会等待，直到消息队列变成非空。而主线程只有将当前的消息处理完后，才会去取下一个消息。

*一次循环*：取一次消息并执行的过程。

*用代码表示事件循环*：
```
while(true){
  var message = queue.get()
  execute(message)
}
```

**异步过程的回调函数，一定不在当前这一轮事件循环中执行**

